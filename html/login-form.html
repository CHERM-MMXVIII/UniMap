<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UNIMAP Login</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="../css/stylesheets.css">
</head>
<body>
<div class="login-wrapper">

    <!-- LEFT SIDE -->
    <div class="login-left">
        <img src="../img/slsu-logo.webp" alt="SLSU Logo">
        <h2>Southern Luzon State University</h2>
        <h1>U N I M A P</h1>
    </div>

    <!-- RIGHT SIDE -->
    <div class="login-right">

        <h1 class="form-title">WELCOME</h1>

        <form>

            <label>Username</label>
            <input type="text" id="username" required>

            <label>Password</label>
            <div class="password-field">
              <input type="password" id="password" required>
              <button type="button" class="toggle-password" data-target="password" aria-label="Show password">
              <!-- eye icon -->
                <svg class="eye eye-open" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M12 5c-7 0-10 7-10 7s3 7 10 7 10-7 10-7-3-7-10-7Zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10Zm0-8a3 3 0 1 0 0 6 3 3 0 0 0 0-6Z"/>
                </svg>
              <!-- eye-slash icon -->
                <svg class="eye eye-closed" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M3 4.3 4.3 3 21 19.7 19.7 21l-3-3c-1.4.7-2.9 1-4.7 1-7 0-10-7-10-7 1-2 2.6-4.2 4.8-5.6L3 4.3Zm9 2.7c7 0 10 7 10 7-.7 1.6-1.8 3.3-3.3 4.6l-2.2-2.2c.3-.6.5-1.3.5-2 0-2.8-2.2-5-5-5-.7 0-1.4.2-2 .5L8.9 7.7c.9-.5 2-.7 3.1-.7Zm-5 7c0 .4.1.8.2 1.2L6.1 14c.6-1.2 1.6-2.1 2.9-2.6l-2.1-2.1c-1.5 1-2.7 2.7-3.5 4.7 0 0 3 7 10 7 1.3 0 2.5-.2 3.6-.6l-2.2-2.2c-.5.2-1 .3-1.4.3-2.8 0-5-2.2-5-5Z"/>
                </svg>
              </button>
            </div>


            <div class="create-acc">
                <span>Donâ€™t have an account?</span>
                <a href="/register">Create account</a>
            </div>

            <div class="btn-row">
                <button type="submit" class="login-btn">Login</button>
                <button type="button" class="guest-btn" onclick="loginAsGuest()">Login as Guest</button>
            </div>

        </form>

    </div>

</div>

<script>
  document.querySelector("form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();

    try {
      const res = await fetch("/api/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password })
      });

      const data = await res.json();

      
    if (data.success) {
        localStorage.setItem("fullname", data.user.fullname);
        localStorage.setItem("username", data.user.username);
        localStorage.setItem("email", data.user.email);
         window.location.href = "/"; // or your homepage route
}   else {
        alert(data.message || "Login failed");
}

    } catch (err) {
      alert("Cannot reach server");
      console.error(err);
    }
    
  });
  
  function loginAsGuest() {
    localStorage.setItem("fullname", "Guest");
    localStorage.setItem("username", "guest");
    window.location.href = "/";
  }

document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".toggle-password").forEach(btn => {
    btn.addEventListener("click", () => {
      const targetId = btn.getAttribute("data-target");
      const input = document.getElementById(targetId);
      if (!input) return;

      const isPassword = input.type === "password";
      input.type = isPassword ? "text" : "password";
      btn.classList.toggle("is-shown", isPassword);
    });
  });
});


</script>

</body>
</html>
